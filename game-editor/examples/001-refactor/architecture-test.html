<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¶æ„é‡æ„æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #2C3E50;
            color: white;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #34495E;
            border-radius: 8px;
        }
        .result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            background: #27AE60;
        }
        .error {
            background: #E74C3C;
        }
        button {
            background: #3498DB;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #2980B9;
        }
    </style>
</head>
<body>
    <h1>ğŸ—ï¸ è›‹è›‹å°„å‡» - æ¶æ„é‡æ„æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ“Š é…ç½®ç³»ç»Ÿæµ‹è¯•</h2>
        <button onclick="testGameConfig()">æµ‹è¯• GameConfig</button>
        <button onclick="testGameConstants()">æµ‹è¯• GameConstants</button>
        <div id="config-results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ¨ é¢œè‰²ç®¡ç†å™¨æµ‹è¯•</h2>
        <button onclick="testColorManager()">æµ‹è¯• ColorManager</button>
        <button onclick="testColorConversion()">æµ‹è¯•é¢œè‰²è½¬æ¢</button>
        <div id="color-results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ¬ åŠ¨ç”»ç®¡ç†å™¨æµ‹è¯•</h2>
        <button onclick="testAnimationManager()">æµ‹è¯• AnimationManager</button>
        <button onclick="testAnimationStats()">æµ‹è¯•åŠ¨ç”»ç»Ÿè®¡</button>
        <div id="animation-results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ”„ RootManager é›†æˆæµ‹è¯•</h2>
        <button onclick="testRootManagerIntegration()">æµ‹è¯• RootManager é›†æˆ</button>
        <button onclick="testBackwardCompatibility()">æµ‹è¯•å‘åå…¼å®¹æ€§</button>
        <div id="integration-results"></div>
    </div>

    <!-- å¼•å…¥è„šæœ¬æ–‡ä»¶ -->
    <script src="src/utils/shared/GameConfig.js"></script>
    <script src="src/utils/shared/GameConstants.js"></script>
    <script src="src/utils/managers/ColorManager.js"></script>
    <script src="src/utils/managers/AnimationManager.js"></script>

    <script>
        // æµ‹è¯•è¾…åŠ©å‡½æ•°
        function addResult(containerId, message, isError = false) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = isError ? 'result error' : 'result';
            div.textContent = message;
            container.appendChild(div);
        }

        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        // é…ç½®ç³»ç»Ÿæµ‹è¯•
        function testGameConfig() {
            clearResults('config-results');
            try {
                const config = new GameConfig();
                
                // æµ‹è¯•åŸºæœ¬è·å–
                const gridRows = config.get('grid.rows');
                addResult('config-results', `âœ… ç½‘æ ¼è¡Œæ•°: ${gridRows}`);
                
                // æµ‹è¯•é¢œè‰²é…ç½®
                const gameColors = config.get('colors.gameEggs');
                addResult('config-results', `âœ… æ¸¸æˆé¢œè‰²æ•°é‡: ${gameColors.length}`);
                
                // æµ‹è¯•è®¾ç½®
                config.set('test.value', 123);
                const testValue = config.get('test.value');
                addResult('config-results', `âœ… è®¾ç½®æµ‹è¯•å€¼: ${testValue}`);
                
                addResult('config-results', 'ğŸ‰ GameConfig æµ‹è¯•å®Œæˆ');
            } catch (error) {
                addResult('config-results', `âŒ GameConfig æµ‹è¯•å¤±è´¥: ${error.message}`, true);
            }
        }

        function testGameConstants() {
            clearResults('config-results');
            try {
                // æµ‹è¯•å¸¸é‡è®¿é—®
                const gameState = GameConstants.GAME_STATES.PLAYING;
                addResult('config-results', `âœ… æ¸¸æˆçŠ¶æ€: ${gameState}`);
                
                const eggRadius = GameConstants.SIZE.EGG_RADIUS;
                addResult('config-results', `âœ… è›‹åŠå¾„: ${eggRadius}`);
                
                // æµ‹è¯•æ–¹æ³•
                const hasPhysics = GameConstants.has('PHYSICS', 'GRAVITY');
                addResult('config-results', `âœ… é‡åŠ›å¸¸é‡å­˜åœ¨: ${hasPhysics}`);
                
                addResult('config-results', 'ğŸ‰ GameConstants æµ‹è¯•å®Œæˆ');
            } catch (error) {
                addResult('config-results', `âŒ GameConstants æµ‹è¯•å¤±è´¥: ${error.message}`, true);
            }
        }

        // é¢œè‰²ç®¡ç†å™¨æµ‹è¯•
        function testColorManager() {
            clearResults('color-results');
            try {
                const colorManager = new ColorManager();
                
                // æµ‹è¯•é¢œè‰²è·å–
                const randomColor = colorManager.getRandomGameEggColor();
                addResult('color-results', `âœ… éšæœºæ¸¸æˆé¢œè‰²: 0x${randomColor.toString(16).toUpperCase()}`);
                
                const gameColors = colorManager.getGameEggColors();
                addResult('color-results', `âœ… æ¸¸æˆé¢œè‰²æ•°é‡: ${gameColors.length}`);
                
                // æµ‹è¯•é¢œè‰²éªŒè¯
                const isValid = colorManager.isValidGameColor(0xFF0000);
                addResult('color-results', `âœ… çº¢è‰²æœ‰æ•ˆæ€§: ${isValid}`);
                
                // æµ‹è¯•é¢œè‰²åç§°
                const colorName = colorManager.getColorName(0xFF0000);
                addResult('color-results', `âœ… çº¢è‰²åç§°: ${colorName}`);
                
                addResult('color-results', 'ğŸ‰ ColorManager æµ‹è¯•å®Œæˆ');
            } catch (error) {
                addResult('color-results', `âŒ ColorManager æµ‹è¯•å¤±è´¥: ${error.message}`, true);
            }
        }

        function testColorConversion() {
            clearResults('color-results');
            try {
                const colorManager = new ColorManager();
                
                // æµ‹è¯•é¢œè‰²è½¬æ¢
                const hex = colorManager.colorToHex(0xFF0000);
                addResult('color-results', `âœ… é¢œè‰²è½¬åå…­è¿›åˆ¶: ${hex}`);
                
                const backToColor = colorManager.hexToColor('#FF0000');
                addResult('color-results', `âœ… åå…­è¿›åˆ¶è½¬é¢œè‰²: 0x${backToColor.toString(16).toUpperCase()}`);
                
                // æµ‹è¯•RGBè½¬æ¢
                const rgb = colorManager.colorToRGB(0xFF0000);
                addResult('color-results', `âœ… RGBåˆ†é‡: R=${rgb.r}, G=${rgb.g}, B=${rgb.b}`);
                
                // æµ‹è¯•é¢œè‰²å˜åŒ–
                const darkerColor = colorManager.darkenColor(0xFF0000, 0.3);
                addResult('color-results', `âœ… å˜æš—å: 0x${darkerColor.toString(16).toUpperCase()}`);
                
                addResult('color-results', 'ğŸ‰ é¢œè‰²è½¬æ¢æµ‹è¯•å®Œæˆ');
            } catch (error) {
                addResult('color-results', `âŒ é¢œè‰²è½¬æ¢æµ‹è¯•å¤±è´¥: ${error.message}`, true);
            }
        }

        // åŠ¨ç”»ç®¡ç†å™¨æµ‹è¯•
        function testAnimationManager() {
            clearResults('animation-results');
            try {
                const animationManager = new AnimationManager();
                
                // æµ‹è¯•ç»Ÿè®¡ä¿¡æ¯
                let stats = animationManager.getStats();
                addResult('animation-results', `âœ… åˆå§‹åŠ¨ç”»ç»Ÿè®¡: æ€»æ•°=${stats.totalAnimations}, æ´»è·ƒ=${stats.activeCount}`);
                
                // æµ‹è¯•åŠ¨ç”»åˆ›å»ºï¼ˆæ¨¡æ‹Ÿï¼‰
                const mockContainer = { addChild: () => {}, removeChild: () => {} };
                const animId = animationManager.createExplosionEffect(mockContainer, 100, 100);
                addResult('animation-results', `âœ… çˆ†ç‚¸åŠ¨ç”»ID: ${animId}`);
                
                stats = animationManager.getStats();
                addResult('animation-results', `âœ… åˆ›å»ºåç»Ÿè®¡: æ€»æ•°=${stats.totalAnimations}, æ´»è·ƒ=${stats.activeCount}`);
                
                addResult('animation-results', 'ğŸ‰ AnimationManager æµ‹è¯•å®Œæˆ');
            } catch (error) {
                addResult('animation-results', `âŒ AnimationManager æµ‹è¯•å¤±è´¥: ${error.message}`, true);
            }
        }

        function testAnimationStats() {
            clearResults('animation-results');
            try {
                const animationManager = new AnimationManager();
                
                // æµ‹è¯•å¤šä¸ªåŠ¨ç”»
                const mockContainer = { addChild: () => {}, removeChild: () => {} };
                
                for (let i = 0; i < 3; i++) {
                    animationManager.createSparkEffect(mockContainer, i * 50, i * 50);
                }
                
                const stats = animationManager.getStats();
                addResult('animation-results', `âœ… æ‰¹é‡åˆ›å»ºå: æ€»æ•°=${stats.totalAnimations}, æ´»è·ƒ=${stats.activeCount}`);
                
                // æµ‹è¯•æ¸…ç†
                animationManager.cleanup();
                const cleanStats = animationManager.getStats();
                addResult('animation-results', `âœ… æ¸…ç†å: æ€»æ•°=${cleanStats.totalAnimations}, æ´»è·ƒ=${cleanStats.activeCount}`);
                
                addResult('animation-results', 'ğŸ‰ åŠ¨ç”»ç»Ÿè®¡æµ‹è¯•å®Œæˆ');
            } catch (error) {
                addResult('animation-results', `âŒ åŠ¨ç”»ç»Ÿè®¡æµ‹è¯•å¤±è´¥: ${error.message}`, true);
            }
        }

        // RootManager é›†æˆæµ‹è¯•éœ€è¦ç®€åŒ–å®ç°ï¼Œå› ä¸ºå®ƒä¾èµ–å®Œæ•´çš„æ¸¸æˆç¯å¢ƒ
        function testRootManagerIntegration() {
            clearResults('integration-results');
            addResult('integration-results', 'âš ï¸ RootManager é›†æˆæµ‹è¯•éœ€è¦å®Œæ•´æ¸¸æˆç¯å¢ƒ');
            addResult('integration-results', 'ğŸ’¡ è¯·åœ¨å®é™…æ¸¸æˆä¸­é€šè¿‡æ§åˆ¶å°æµ‹è¯•');
            addResult('integration-results', 'ğŸ“ æµ‹è¯•å‘½ä»¤: window.rootManager.colorManager.getGameEggColors()');
        }

        function testBackwardCompatibility() {
            clearResults('integration-results');
            addResult('integration-results', 'âš ï¸ å‘åå…¼å®¹æ€§æµ‹è¯•éœ€è¦å®Œæ•´æ¸¸æˆç¯å¢ƒ');
            addResult('integration-results', 'ğŸ’¡ è¯·éªŒè¯ç°æœ‰æµ‹è¯•æ¨¡å—æ˜¯å¦æ­£å¸¸å·¥ä½œ');
            addResult('integration-results', 'ğŸ“ æ£€æŸ¥ Step1-8 æ˜¯å¦èƒ½æ­£å¸¸åŠ è½½å’Œè¿è¡Œ');
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„è‡ªåŠ¨æµ‹è¯•
        document.addEventListener('DOMContentLoaded', () => {
            addResult('config-results', 'ğŸš€ æ¶æ„é‡æ„æµ‹è¯•é¡µé¢å·²åŠ è½½');
            addResult('color-results', 'ğŸ¨ ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•å„æ¨¡å—åŠŸèƒ½');
            addResult('animation-results', 'ğŸ¬ æ‰€æœ‰ç®¡ç†å™¨å·²å‡†å¤‡å°±ç»ª');
            addResult('integration-results', 'ğŸ”„ é›†æˆæµ‹è¯•éœ€è¦å®Œæ•´æ¸¸æˆç¯å¢ƒ');
        });
    </script>
</body>
</html>
